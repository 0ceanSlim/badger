{{define "view"}}
<main class="flex flex-col my-16 md:my-32">
  <div class="flex flex-col items-center mb-8 md:flex-row md:items-start">
    <img
      src="{{.Picture}}"
      alt="Profile Picture"
      class="w-24 h-24 mx-6 mb-4 border-4 rounded-lg md:w-32 md:h-32 md:mb-0 border-bgInverted"
    />
    <div class="text-center md:text-left">
      <h2 class="mb-2 text-xl font-semibold md:text-2xl">{{.DisplayName}}</h2>
      <p class="max-w-xs md:max-w-md text-textMuted">{{.About}}</p>
    </div>
  </div>

  <!-- Tabbed Container -->
  <div
    class="w-full max-w-4xl p-4 mx-auto rounded-lg shadow-md bg-bgSecondary text-textPrimary"
  >
    <div class="flex mb-4 border-b border-bgInverted">
      <button
        hx-get="/profile-badges"
        hx-target="#tab-content"
        hx-trigger="load,click"
        hx-swap="innerHTML"
        class="px-4 py-2 text-sm font-semibold text-white bg-purple-500 rounded-t-md hover:bg-purple-700"
        onclick="showTab('collected')"
      >
        Profile Badges
      </button>
      <button
        hx-get="/awarded-badges"
        hx-target="#tab-content"
        hx-trigger="load,click"
        hx-swap="innerHTML"
        class="px-4 py-2 ml-2 text-sm font-semibold text-white bg-purple-500 rounded-t-md hover:bg-purple-700"
        onclick="showTab('awarded')"
      >
        Awarded Badges
      </button>
      <button
        hx-get="/created-badges"
        hx-target="#tab-content"
        hx-trigger="load,click"
        hx-swap="innerHTML"
        class="px-4 py-2 ml-2 text-sm font-semibold text-white bg-purple-500 rounded-t-md hover:bg-purple-700"
        onclick="showTab('created')"
      >
        Created Badges
      </button>
    </div>

    <!-- Spinner shown during loading -->
    <div id="tab-content" class="p-4">
      <div id="spinner" class="spinner"></div>
      <!-- Spinner is shown here while loading -->
    </div>
  </div>

  <script>
    function toggleDropdown() {
      const dropdown = document.getElementById("dropdown");
      dropdown.classList.toggle("hidden");
    }

    // Check if the Nostr extension is available
    window.onload = function () {
      if (!window.nostr) {
        alert("Nostr extension not available. Redirecting to login...");
        window.location.href = "/login";
      }
    };
  </script>
  <script>
    // Function to show spinner before content is loaded
    function showSpinner() {
      document.getElementById("spinner").style.display = "block";
    }

    // Function to hide spinner after content is loaded
    function hideSpinner() {
      document.getElementById("spinner").style.display = "none";
    }

    // Function to handle tab switching
    function showTab(tab) {
      // Ensure spinner is shown while loading content
      showSpinner();
      setTimeout(function () {
        // Hide spinner after a delay to simulate loading
        hideSpinner();
      }, 500); // Adjust this delay based on actual content loading time
    }

    // Hide spinner after page load is complete
    document.addEventListener("htmx:afterOnLoad", function () {
      hideSpinner();
    });
  </script>
</main>
{{end}}
